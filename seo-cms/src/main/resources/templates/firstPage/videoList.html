<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SEO - 后台管理系统</title>
    <!-- bootstrap 3.0.2 -->
    <link href="/resource/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- font Awesome -->
    <link href="/resource/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <!-- iCheck for checkboxes and radio inputs -->
    <link href="/resource/css/iCheck/all.css" rel="stylesheet" type="text/css" />
    <!-- Theme style -->
    <link href="/resource/css/style.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="/resource/js/webuploader-0.1.5/webuploader.css">   
    <link rel="stylesheet" type="text/css" href="/resource/js/jQueryMessage/css/message.skin.css" /> 
</head>

<body>
<input type="hidden" value="firstPage/videoList.html">
<div class="row">
    <div class="col-md-12">
    	<h1 class="panel-heading"></h1>
        <!--breadcrumbs start -->
        <ul class="breadcrumb">
            <li><a href="javascript:;"><i class="fa fa-home"></i> </li>
            <li><a th:href="@{/firstPage/module(belong=${module.belong})}" th:text="${constantDefinition.name}"><i class="fa fa-home"></i> </a></li>
            <li><a th:href="@{/firstPage/module/project(moduleId=${module.id})}" th:text="${module.name}"><i class="fa fa-home"></i> </a></li>
            <li><a href="javascript:;" th:text="${project.name}"><i class="fa fa-home"></i> </a></li>
            <li class="active">视频列表</li>
        </ul>

        <section class="panel">
            <div class="panel-body">
                <!-- <span class="pull-right badge badge-info">32</span> -->
                <button class="btn btn-primary btn-addon btn-sm" data-toggle="modal" th:onclick="javascript: openUploadDialog()">
                    <i class="fa fa-plus"></i>添加视频
                </button>
            </div>

        </section>
        <span th:each="seoVideo : ${seoVideoList}">
            <p>排序号:<span th:text="${seoVideo.sort}"></span>  <a href="javascript:;"  th:aid="${seoVideo.id}"  onclick="onDelete(this.getAttribute('aid'));">删除</a> </p>
            <div class="divcss5" th:id="dplayer+${seoVideoStat.index}"></div>
            <p></p>
            <hr size="100" color="black"/>
            <p></p>
            <p></p>
            <p></p>
            <p></p>
        </span>

    </div>
</div>

<div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="upload-dialog" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                <h4 class="modal-title" id="aaa">添加视频</h4>
            </div>
				<div class="modal-body"><div class="alert alert-block albelongIdert-danger">
					<strong>注意!</strong> 上传成功后切记点击确定按钮，否则不会保存！
				</div>
                    <input name="attachmentId" id="attachmentId" type="hidden" th:value="${belongId}"/>
            	<form class="col s12" id="form1" th:action="@{/subProject/videoSave}" method="post">
					<input name="attachment.filename" id="filename" type="hidden" />
					<input name="attachment.filepath" id="filepath" type="hidden" />
					<input name="attachment.filetype" id="filetype" type="hidden" />
					<input name="attachment.filesize" id="filesize" type="hidden" />
                    <input name="belongId" id="belongId" type="hidden" th:value="${belongId}"/>
                    <input name="fromType" id="fromType" type="hidden" th:value="${fromType}"/>

					<div id="uploader" class="wu-example">
						<div class="btns">
							banner: <div id="picker">选择视频...</div> <button type="button" class="btn btn-primary btn-addon btn-sm" onclick="clearPicture();">清除图片或视频</button>
						</div>
					</div>

					<div class="wu-example">
						排序号：<input name="sort" id="sort" />
					</div>

				</form>
            </div>
            <div class="modal-footer">
            	<button type="button" class="btn btn-primary btn-addon btn-sm" onclick="save();">确定</button>
            </div>
        </div>
    </div>
</div>
<script src="/resource/DPlayer.min.js"></script>

<!-- jQuery 2.0.2 -->
<script src="/resource/js/jquery.min.js" type="text/javascript"></script>
<!-- Bootstrap -->
<script src="/resource/js/bootstrap.min.js" type="text/javascript"></script>
<!-- iCheck -->
<script src="/resource/js/plugins/iCheck/icheck.min.js" type="text/javascript"></script>
<script type="text/javascript" src="/resource/js/webuploader-0.1.5/webuploader.js"></script>
<script type="text/javascript" src="/resource/js/jQueryMessage/js/jquery.plugin.message.js"></script>
<script src="/resource/js/clipboard.min.js" type="text/javascript"></script>
<script type="text/javascript" th:inline="javascript">
	var system = [[${system}]];
	function initUploader(picker,inputEl){
    	var uploader = WebUploader.create({
    		auto: true,
	        // swf文件路径
	        swf: '/resource/js/webuploader-0.1.5/Uploader.swf',
	        // 文件接收服务端。
	        server: '/upload/uploadFile',
	        // 选择文件的按钮。可选。
	        compress: false,
	        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
	        pick: '#' + picker,
	        fileNumLimit: 1,
	        // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
	        resize: false,
            accept: {
				mimeTypes: 'video/*'
	        }
	    });
    	uploader.on('fileQueued', function(file) {
    		
    	});
	    uploader.on('uploadSuccess', function(file, response) {
	    	console.log(response);
	    	$("body").MessageBox({
				type: 'success',
				message: '上传成功！',
				timeout:3000,
				callbak:null
			});
	    	$("#filename").val(response.data.originalFilename);
	    	$("#filepath").val(response.data.filepath);
	    	$("#filesize").val(response.data.filesize);
	    	$("#filetype").val(response.data.filetype);
	    });
	    uploader.on('uploadError', function( file ) {
	    	$("body").MessageBox({
				type: 'error',
				message: '上传失败！',
				timeout:3000,
				callbak:null
			});
	    });
    }
    
    $(document).ready(function () {
    	$("#upload-dialog").on('shown.bs.modal',function(){
	    	initUploader("picker","fileUpload");
		});
	    renderCheckBox();
    });
	
	function renderCheckBox(){
		$('input').on('ifChecked', function(event) {
		    $(this).parents('li').addClass("task-done");
		    console.log('ok');
		});
		$('input').on('ifUnchecked', function(event) {
		    $(this).parents('li').removeClass("task-done");
		    console.log('not');
		});
		
		$('input[type="checkbox"].flat-grey, input[type="radio"].flat-grey').iCheck({
		    checkboxClass: 'icheckbox_flat-grey',
		    radioClass: 'iradio_flat-grey'
		});
	}
	
	function openUploadDialog(){
			$("#aaa").html("添加类目");
		$("#upload-dialog").modal();
	}

	function openUploadDialogForUpdate(id){
		$.ajax({
			type: 'get',
			url: "/firstPage/module/getById?moduleId=" + id,
			contentType: 'application/json',
			async: false,
			success: function(module) {
				$("#id").val(id);

				if(!isEmpty(module.attachment)){
					$("#filename").val(module.attachment.filename);
					$("#filepath").val(module.attachment.filepath);
					$("#filesize").val(module.attachment.filesize);
					$("#filetype").val(module.attachment.filetype);
					$("#attachmentid").val(module.attachment.id);
				}

				$("#name").val(module.name);
				$("#sort").val(module.sort);
				$("#title").val(module.title);
				$("#keywords").val(module.keywords);
				$("#description").val(module.description);
				$("#alt").val(module.alt);
				$("#clickUrl").val(module.clickUrl);
				$("#code").val(module.code);
				$("#describeMsg").val(module.describeMsg);

				$("#aaa").html("编辑类目");
			}
		});

		$("#upload-dialog").modal();
	}

	function isEmpty(obj) {
		if (obj == null || obj == "" || obj == "undefined") {
			return true;
		}
		return false;
    }

	function clearPicture(){
		$("#filename").val('');
		$("#filepath").val('');
		$("#filesize").val('');
		$("#filetype").val('');
		$("#attachmentid").val('');

		$("body").MessageBox({
				type: 'success',
				message: '已清除！',
				timeout:5000,
				callbak:null
			});
	}

	function save(){
		var filepath = $("#filepath").val();
		if(isEmpty(filepath)){
			$("body").MessageBox({
				type: 'error',
				message: '请填选择视频！',
				timeout:5000,
				callbak:null
			});
			return;
		}

		var sort = $("#sort").val();
		if(isEmpty(sort)){
			$("body").MessageBox({
				type: 'error',
				message: '排序不能为空！',
				timeout:5000,
				callbak:null
			});
			return;
		}

		var posPattern = /^\d+$/;
		if(!posPattern.test(sort)){
			$("body").MessageBox({
				type: 'error',
				message: '排序必须为数字，并且必须大于0！',
				timeout:5000,
				callbak:null
			});
			return;
		}
		$("#form1").submit();
	}
	
	function confrimRemove(id){
		$("#remove-dialog").modal();
		$("#cacheID").val(id);
	}
	
	function remove(){
		var currentID = $("#cacheID").val();
		window.location.href="/firstPage/module/delete?id="+currentID;
		$("#remove-dialog").modal('hide');
	}

	function onDelete(id){


	}

</script>

<script type="text/javascript" th:inline="javascript">

var seoVideoList = [[${seoVideoList}]];
var baseUrl = '[(${baseUrl})]';

for(var i = 0;i < seoVideoList.length; i++){

    var video = seoVideoList[i];
    var fileId = video.attachment.fileId;

    new DPlayer({

        container: document.getElementById('dplayer' + i),
        video: {
            url:  baseUrl + '/video/' + fileId + '.mp4',
        },
        autoplay:true,
    });
}

</script>

<style type="text/css">
.divcss5{ border:1px solid #F00; width:1000px; height:1000px}
</style>
</body>
</html>
